<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
<script>
const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

const cities=[]
// Fetch API æä¾›äº†ä¸€ä¸ª JavaScript æ¥å£ï¼Œç”¨äºè®¿é—®å’Œæ“çºµ HTTP ç®¡é“çš„ä¸€äº›å…·ä½“éƒ¨åˆ†ï¼Œä¾‹å¦‚è¯·æ±‚å’Œå“åº”
fetch(endpoint)
  .then(blob=>blob.json())
  .then(data=>{
    // å°†dataå­˜å…¥citiesä¸­
    cities.push(...data)
    // console.log(cities);
})

// åŒ¹é…è¾“å…¥å€¼
function findMatches(wordToMatch,cities){
  return cities.filter(place=>{
    // RegExpæ­£åˆ™è¡¨è¾¾å¼
    // i: ignoreCase   å¿½ç•¥å•è¯å¤§å°å†™åŒ¹é…
    // m: multiline    å¯ä»¥è¿›è¡Œå¤šè¡ŒåŒ¹é…
    // g: global       å…¨å±€åŒ¹é…
    const regex = new RegExp(wordToMatch, 'gi')
    // match() æ–¹æ³•å°†å­—ç¬¦ä¸²ä¸æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ã€‚
    return place.city.match(regex)||place.state.match(regex)
  })
  
}
function displayMatches(){
  console.log(this.value);
  const matchArray=findMatches(this.value,cities)
  console.log(matchArray);
  // mapå’Œforeachå‡½æ•°åŒºåˆ«  forEach() ä¼šä¿®æ”¹åŸæ¥çš„æ•°ç»„ã€‚ map()æ–¹æ³•ä¼šå¾—åˆ°ä¸€ä¸ªæ–°çš„æ•°ç»„å¹¶è¿”å›ã€‚
  const html= matchArray.map(place => {
    const regex=new RegExp(this.value,'gi')
    const city=place.city.replace(regex,`<span class="hl">${this.value}</span>`)
    const state = place.state.replace(regex, `<span class="hl">${this.value}</span>`)
    return `<li><span>${city},${state}</span></li>`    
  }).join('');
  // join() æŠŠæ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ è½¬æ¢ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²
  suggestions.innerHTML =html
}
// è·å–input ul
const searchInput=document.querySelector('.search')
const suggestions=document.querySelector('.suggestions')
// ç»™inputç»‘å®škeyup changeäº‹ä»¶
searchInput.addEventListener('keyup',displayMatches)
// searchInput.addEventListener('change',displayMatches)
</script>
</body>
</html>
